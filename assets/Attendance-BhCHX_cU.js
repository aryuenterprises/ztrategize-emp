import{u as X,r as s,a as k,A as T,j as e,M as Z,b as ee,B as te,I as ae,D as se,C as ne,F as le,y as oe,S as re}from"./index-BoPV0jdw.js";const ce=()=>{var I,N;let F=X();const[L,D]=s.useState(""),[E,B]=s.useState(""),[O,x]=s.useState(!0);s.useEffect(()=>{const t=()=>{const n=new Date,o=` ${n.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}`,Q=`${String(n.getDate()).padStart(2,"0")}-${String(n.getMonth()+1).padStart(2,"0")}-${n.getFullYear()}`;D(o),B(Q)};t();const a=setInterval(t,1e3);return()=>clearInterval(a)},[]);const[g,C]=s.useState("Day Shift"),[d,m]=s.useState(""),[u,p]=s.useState(""),[c,W]=s.useState(""),[f,A]=s.useState(""),[_,R]=s.useState(""),[l,w]=s.useState(""),[r,$]=s.useState([]),[h,v]=s.useState(""),[V,i]=s.useState(!1);s.useEffect(()=>{const t=JSON.parse(localStorage.getItem("hrms_employee"));A(t._id);const a=localStorage.getItem("hrms_employee_token");R(a),S(t._id)},[]);const[j,M]=s.useState(""),H=r.flatMap(t=>t.entries.map(a=>{const n=new Date(a.time);return{data:n.toISOString().split("T")[0].split("-").reverse().join("-"),entry_time:n.toLocaleTimeString(),comand:a.reason}})),U=[{field:"data",header:"Attendance Date"},{field:"entry_time",header:"Attendance Time"},{field:"comand",header:"Reason",body:t=>e.jsx("div",{className:"capitalize",children:t.comand=="Break Out"?"Start Break":t.comand=="Break In"?"End Break":t.comand})}],z=async()=>{i(!0);try{let t={dateTime:new Date().toISOString(),employeeId:f,comments:"hello",shift:g,workType:d,reason:u};const a=await k.post(`${T}api/attendance/mark`,t);w(""),p(""),S(f,_),W(u),i(!1),oe.success("Attendance marked successfully!")}catch(t){console.log(t),w(t.response.data.message),i(!1)}},S=async(t,a)=>{i(!0);try{const n=await k.get(`${T}api/attendance/attendancelist`,{params:{employeeId:t}});$(n.data.data),x(!1),P(n.data.data),p(""),i(!1)}catch(n){console.log(n),x(!1)}},P=t=>{var a;if(t.length>0){const n=((a=t[0])==null?void 0:a.entries)||[];if(n.length>0){const o=n[0];v(o.reason)}else console.log("No entries found in latest attendance record.")}else v(""),console.log("No attendance data found.")},G=t=>{p(t)},[ie,y]=s.useState(()=>{const t=localStorage.getItem("stopwatchValue");return t?parseInt(t,10):0}),b=()=>{window.stopwatchInterval||(window.stopwatchInterval=setInterval(()=>{const t=parseInt(localStorage.getItem("stopwatchStart"),10);if(t){const a=Date.now()-t;localStorage.setItem("stopwatchValue",a),window.dispatchEvent(new Event("stopwatchUpdate"))}},1e3))},J=()=>{const t=localStorage.getItem("stopwatchStart"),a=localStorage.getItem("pausedTime");a?(localStorage.setItem("stopwatchStart",Date.now()-parseInt(a,10)),localStorage.removeItem("pausedTime")):t||localStorage.setItem("stopwatchStart",Date.now()),b()},Y=()=>{clearInterval(window.stopwatchInterval),window.stopwatchInterval=null;const t=parseInt(localStorage.getItem("stopwatchValue"),10);localStorage.setItem("pausedTime",t)},q=()=>{clearInterval(window.stopwatchInterval),window.stopwatchInterval=null,localStorage.removeItem("stopwatchStart"),localStorage.removeItem("stopwatchValue"),localStorage.removeItem("pausedTime"),window.dispatchEvent(new Event("stopwatchUpdate"))};s.useEffect(()=>{const t=()=>{const o=localStorage.getItem("stopwatchValue");y(o?parseInt(o,10):0)};t(),window.addEventListener("stopwatchUpdate",t);const a=localStorage.getItem("stopwatchStart"),n=localStorage.getItem("pausedTime");return a&&!n&&b(),c==="Login"||c==="Break In"?J():c==="Break Out"?Y():c==="Logout"&&q(),()=>{window.removeEventListener("stopwatchUpdate",t)}},[c]);function K(){F("/monthlyattendancedetails"),window.scrollTo({top:0,behavior:"instant"})}return s.useEffect(()=>{r.length>0&&!d&&m(r[0].workType)},[r]),e.jsxs("div",{className:" w-screen min-h-screen overflow-x-hidden flex flex-col justify-between bg-gray-100 ",children:[e.jsxs("div",{className:"px-3 py-3 md:px-7 lg:px-10 xl:px-16 md:py-10",children:[e.jsx(Z,{}),e.jsx(ee,{}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("p",{className:"text-sm text-blue-500",children:"Attendance"}),e.jsx("p",{children:">"})]}),e.jsx("section",{className:"flex flex-col md:flex-row justify-end ",children:e.jsx("button",{onClick:K,className:"px-2 py-1 md:px-4 md:py-2 mt-5 md:mt-8 w-fit cursor-pointer rounded-full text-white bg-blue-500 hover:bg-blue-600 duration-300  font-medium",children:"Monthly Details"})}),e.jsxs("div",{className:"bg-[url('././assets/zigzaglines_large.svg')]  bg-no-repeat bg-cover bg-center rounded-3xl bg-opacity-25 mt-8 px-5 py-3",children:[e.jsx("p",{className:"text-2xl md:text-3xl font-semibold",children:"Attendance"}),e.jsx("div",{className:"flex w-full mt-5 justify-center items-center",children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-x-8 justify-between",children:[e.jsx("p",{children:"Current Date & time"}),e.jsx("input",{type:"text",name:"",id:"",readOnly:!0,value:`${E} ${L}`,className:"border w-full md:w-96 rounded-md py-1 px-2 h-10 outline-none"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-x-8 justify-between",children:[e.jsx("p",{children:"Shift"}),e.jsx("div",{className:"flex gap-8 w-full md:w-96",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"radio",name:"Day Shift",id:"Day Shift",value:"Day Shift",onChange:t=>C(t.target.value),checked:g==="Day Shift"}),e.jsx("label",{htmlFor:"Day Shift",children:"Day Shift"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-x-8 justify-between",children:[e.jsxs("div",{className:"",children:[e.jsx("p",{children:"Work Type"}),(l==null?void 0:l.workType)&&e.jsx("p",{className:"text-red-500",children:l.workType})]}),e.jsxs("div",{className:"flex gap-8 w-full md:w-96",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"workType",id:"WFO",value:"WFO",onChange:t=>m(t.target.value),checked:d==="WFO",disabled:((I=r[0])==null?void 0:I.workType)==="WFH"}),e.jsx("label",{htmlFor:"WFO",children:"WFO"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"workType",id:"WFH",value:"WFH",onChange:t=>m(t.target.value),checked:d==="WFH",disabled:((N=r[0])==null?void 0:N.workType)==="WFO"}),e.jsx("label",{htmlFor:"WFH",children:"WFH"})]})]})]}),e.jsxs("div",{className:"flex flex-col  lg:flex-row lg:items-center  gap-x-8 justify-between",children:[e.jsx("p",{children:"Reason"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("select",{name:"reason",id:"reason",className:"border w-full py-1 px-2 md:w-96 h-10 rounded-md outline-none cursor-pointer",onChange:t=>G(t.target.value),children:[e.jsx("option",{selected:!u,value:"",disabled:!0,className:`${l.reason?"text-red-500":"text-black"}`,children:"Select"}),h==="Login"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"Break Out",className:"cursor-pointer",children:"Start Break"}),e.jsx("option",{value:"Logout",className:"cursor-pointer",children:"Logout"})]}):h==="Break Out"?e.jsx(e.Fragment,{children:e.jsx("option",{value:"Break In",className:"cursor-pointer",children:"End Break"})}):h==="Break In"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"Break Out",className:"cursor-pointer",children:"Start Break"}),e.jsx("option",{value:"Logout",className:"cursor-pointer",children:"Logout"})]}):e.jsx("option",{value:"Login",className:"cursor-pointer",children:"Login"})]}),(l==null?void 0:l.reason)&&e.jsx("p",{className:"text-red-500",children:l.reason})]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{onClick:z,className:"bg-blue-500 hover:bg-blue-600 hidden md:block text-white px-5 md:px-10 py-1 md:py-2.5  rounded-full",children:e.jsx("div",{className:"w-12 h-6 flex items-center justify-center",children:V?e.jsx(te,{}):"Submit"})})})]})})]}),e.jsxs("div",{style:{width:"auto",margin:"0 auto"},children:[e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx(ae,{value:j,onChange:t=>M(t.target.value),placeholder:"Search",className:"px-5 py-2 md:px-2 md:py-2 rounded-md"})}),e.jsxs("div",{className:"relative mt-4",children:[O&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex justify-center items-center z-10",children:e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent border-solid rounded-full animate-spin"})}),e.jsx(se,{className:"mt-8",value:H,paginator:!0,rows:10,rowsPerPageOptions:[5,10,20],globalFilter:j,showGridlines:!0,resizableColumns:!0,children:U.map((t,a)=>e.jsx(ne,{field:t.field,header:t.header,body:t.body,style:{minWidth:"150px",wordWrap:"break-word",overflow:"hidden",whiteSpace:"normal"}},a))})]})]})]}),e.jsx(le,{})]})},me=()=>e.jsxs("div",{className:"flex",children:[e.jsx("div",{children:e.jsx(re,{})}),e.jsx(ce,{})]});export{me as default};
